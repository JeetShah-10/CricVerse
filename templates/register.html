{% extends 'base.html' %}
{% block title %}Register â€¢ CricVerse{% endblock %}
{% block content %}
<div class="d-flex justify-content-center align-items-center min-vh-100 px-4 py-5">
    <div class="w-100" style="max-width: 500px;">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white text-center p-4">
                <h3 class="h3 fw-bold mb-0">Create Your Fan Account</h3>
            </div>
            <div class="card-body p-4 p-md-5">
                <form method="post" action="{{ url_for('auth.register') }}">
                    <div class="mb-3">
                        <label for="name" class="form-label fw-medium">Name</label>
                        <input type="text" class="form-control form-control-lg" id="name" name="name" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="phone" class="form-label fw-medium">Phone</label>
                        <input type="tel" class="form-control form-control-lg" id="phone" name="phone" placeholder="Enter your phone number">
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label fw-medium">Email</label>
                        <input type="email" class="form-control form-control-lg" id="email" name="email" placeholder="Enter your email address" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="password" class="form-label fw-medium">Password</label>
                        <input type="password" class="form-control form-control-lg" id="password" name="password" placeholder="Create a password" required>
                        <div class="form-text text-muted">
                            Password must be at least 8 characters long
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">Register</button>
                    </div>
                </form>
                <div class="text-center mt-4">
                    <p class="text-muted">Already have an account? <a href="{{ url_for('auth.login') }}" class="text-decoration-none">Login here</a></p>
                    <hr class="my-3">
                    <p class="text-muted">Want to manage a stadium?</p>
                    <a href="{{ url_for('apply_stadium_owner') }}" class="btn btn-outline-secondary">Apply to be a Stadium Owner</a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Enhanced Registration Form Validation
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.querySelector('form');
    const passwordInput = document.getElementById('password');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    
    // Password strength validation
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        const feedback = this.parentNode.querySelector('.password-feedback');
        
        if (!feedback) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = 'password-feedback mt-2';
            this.parentNode.appendChild(feedbackDiv);
        }
        
        const requirements = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /\d/.test(password),
            special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
        };
        
        const strength = Object.values(requirements).filter(Boolean).length;
        const colors = ['text-danger', 'text-warning', 'text-info', 'text-success', 'text-primary'];
        const labels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
        
        const feedbackElement = this.parentNode.querySelector('.password-feedback');
        feedbackElement.innerHTML = "`
            <div class="${colors[strength - 1] || 'text-muted'} small">
                <i class="fas fa-shield-alt me-1"></i>
                Password Strength: ${labels[strength - 1] || 'Too Short'}
            </div>
            <div class="mt-1 small text-muted">
                <div class="${requirements.length ? 'text-success' : 'text-muted'}">
                    <i class="fas ${requirements.length ? 'fa-check' : 'fa-times'} me-1"></i>
                    At least 8 characters
                </div>
                <div class="${requirements.uppercase ? 'text-success' : 'text-muted'}">
                    <i class="fas ${requirements.uppercase ? 'fa-check' : 'fa-times'} me-1"></i>
                    Uppercase letter
                </div>
                <div class="${requirements.lowercase ? 'text-success' : 'text-muted'}">
                    <i class="fas ${requirements.lowercase ? 'fa-check' : 'fa-times'} me-1"></i>
                    Lowercase letter
                </div>
                <div class="${requirements.number ? 'text-success' : 'text-muted'}">
                    <i class="fas ${requirements.number ? 'fa-check' : 'fa-times'} me-1"></i>
                    Number
                </div>
            </div>
        ";
    });
    
    // Form validation on submit
    registerForm.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const name = nameInput.value.trim();
        const email = emailInput.value.trim();
        
        let isValid = true;
        let errorMessages = [];
        
        // Name validation
        if (name.length < 2) {
            errorMessages.push('Name must be at least 2 characters long.');
            isValid = false;
        }
        
        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            errorMessages.push('Please enter a valid email address.');
            isValid = false;
        }
        
        // Password validation
        if (password.length < 8) {
            errorMessages.push('Password must be at least 8 characters long.');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            
            // Show validation errors
            let errorDiv = document.querySelector('.validation-errors');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'validation-errors alert alert-danger mt-3';
                registerForm.appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = "`
                <h6><i class=\"fas fa-exclamation-triangle me-2\"></i>Please fix the following issues:</h6>
                <ul class=\"mb-0\">
                    ${errorMessages.map(msg => `<li>${msg}</li>`).join('')}
                </ul>
            `";
            
            // Scroll to error
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            // Remove any existing error messages
            const errorDiv = document.querySelector('.validation-errors');
            if (errorDiv) {
                errorDiv.remove();
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating Account...';
            submitBtn.disabled = true;
            
            // Re-enable form if there's an error (handled by Flask flash messages)
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 3000);
        }
    });
});
</script>
{% endblock %}
