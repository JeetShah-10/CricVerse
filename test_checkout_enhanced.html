<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Enhanced CricVerse Checkout Test</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        /* Enhanced checkout styles */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .checkout-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 800px;
        }
        
        .checkout-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .stepper {
            display: flex;
            justify-content: center;
            padding: 2rem 0;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .stepper-item {
            display: flex;
            align-items: center;
            margin: 0 1rem;
            position: relative;
        }
        
        .stepper-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 2rem;
            height: 2px;
            background: #dee2e6;
        }
        
        .stepper-item.active::after {
            background: #0d6efd;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #dee2e6;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .stepper-item.active .step-number {
            background: #0d6efd;
            color: white;
        }
        
        .step-title {
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .stepper-item.active .step-title {
            color: #0d6efd;
        }
        
        .step-container {
            display: none;
            padding: 2rem;
        }
        
        .step-container.active {
            display: block;
        }
        
        .order-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .payment-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .payment-method-card {
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .payment-method-card:hover {
            border-color: #0d6efd;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.15);
        }
        
        .payment-method-card.selected {
            border-color: #0d6efd;
            background: #f0f8ff;
        }
        
        .method-content {
            display: flex;
            align-items: center;
        }
        
        .method-icon {
            width: 40px;
            height: 40px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .method-icon img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .method-icon i {
            font-size: 1.5rem;
            color: #6c757d;
        }
        
        .payment-details-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }
        
        .features-list li {
            padding: 0.25rem 0;
        }
        
        .payment-btn {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .payment-btn:disabled {
            opacity: 0.7;
        }
        
        .confirmation-card {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            margin: 2rem 0;
        }
        
        .confirmation-details {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            color: #333;
        }
        
        .test-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
        }
        
        .test-controls h6 {
            margin-bottom: 1rem;
            color: #333;
        }
        
        .test-controls .btn {
            margin: 0.25rem;
            font-size: 0.8rem;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .checkout-container {
                margin: 1rem;
                border-radius: 12px;
            }
            
            .stepper {
                padding: 1rem 0;
            }
            
            .stepper-item {
                margin: 0 0.5rem;
            }
            
            .stepper-item:not(:last-child)::after {
                right: -1rem;
                width: 1rem;
            }
            
            .step-number {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .step-title {
                font-size: 0.8rem;
            }
            
            .payment-methods-grid {
                grid-template-columns: 1fr;
            }
            
            .test-controls {
                position: relative;
                top: auto;
                right: auto;
                margin: 1rem;
            }
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Test Controls -->
    <div class="test-controls">
        <h6><i class="bi bi-gear-fill me-2"></i>Test Controls</h6>
        <button class="btn btn-sm btn-outline-primary" onclick="testOfflineMode()">
            <i class="bi bi-wifi-off"></i> Test Offline
        </button>
        <button class="btn btn-sm btn-outline-success" onclick="testOnlineMode()">
            <i class="bi bi-wifi"></i> Test Online
        </button>
        <button class="btn btn-sm btn-outline-warning" onclick="testError()">
            <i class="bi bi-exclamation-triangle"></i> Test Error
        </button>
        <button class="btn btn-sm btn-outline-info" onclick="testMobile()">
            <i class="bi bi-phone"></i> Test Mobile
        </button>
        <button class="btn btn-sm btn-outline-secondary" onclick="resetCheckout()">
            <i class="bi bi-arrow-clockwise"></i> Reset
        </button>
    </div>

    <div class="container">
        <div class="checkout-container">
            <!-- Header -->
            <div class="checkout-header">
                <h1><i class="bi bi-cricket me-2"></i>CricVerse Checkout</h1>
                <p class="mb-0">Big Bash League - Enhanced Experience</p>
            </div>
            
            <!-- Stepper -->
            <div class="stepper">
                <div class="stepper-item active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-title">Order Summary</div>
                </div>
                <div class="stepper-item" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-title">Payment</div>
                </div>
                <div class="stepper-item" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-title">Confirmation</div>
                </div>
            </div>
            
            <!-- Step 1: Order Summary -->
            <div class="step-container active" id="order-summary-step">
                <h3><i class="bi bi-cart-check me-2"></i>Order Summary</h3>
                
                <div class="order-items">
                    <!-- Items will be populated by JavaScript -->
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="order-totals">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <span id="subtotal-amount">$60.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Service Fee:</span>
                                <span id="fee-amount">$3.00</span>
                            </div>
                            <div class="d-flex justify-content-between fw-bold border-top pt-2">
                                <span>Total:</span>
                                <span id="total-amount">$63.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="currency-selector">
                            <label for="currency-select" class="form-label">Currency</label>
                            <select class="form-select" id="currency-select">
                                <option value="USD">USD - US Dollar</option>
                                <option value="AUD">AUD - Australian Dollar</option>
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="text-end mt-4">
                    <button class="btn btn-primary btn-lg" id="proceed-to-payment">
                        <i class="bi bi-arrow-right me-2"></i>Proceed to Payment
                    </button>
                </div>
            </div>
            
            <!-- Step 2: Payment -->
            <div class="step-container" id="payment-step">
                <h3><i class="bi bi-credit-card me-2"></i>Payment Method</h3>
                
                <div id="payment-message" class="alert" style="display: none;"></div>
                
                <form id="unified-payment-form">
                    <input type="hidden" name="csrf_token" value="demo_token">
                    <input type="hidden" id="amount-input" name="amount" value="63.00">
                    <input type="hidden" id="booking-type-input" name="booking_type" value="ticket">
                    <input type="hidden" id="event-id-input" name="event_id" value="123">
                    <input type="hidden" id="seat-ids-input" name="seat_ids" value="[456]">
                    <input type="hidden" id="description-input" name="description" value="BBL Booking">
                    
                    <div id="payment-methods-container">
                        <!-- Payment methods will be loaded here -->
                    </div>
                    
                    <div id="payment-details">
                        <!-- Payment details will be shown here -->
                    </div>
                    
                    <div id="payment-button-container" class="mt-4">
                        <!-- Payment button will be shown here -->
                    </div>
                </form>
                
                <div class="text-start mt-3">
                    <button class="btn btn-outline-secondary" id="back-to-order">
                        <i class="bi bi-arrow-left me-2"></i>Back to Order
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Confirmation -->
            <div class="step-container" id="confirmation-step">
                <div class="confirmation-card">
                    <i class="bi bi-check-circle-fill display-4 mb-3"></i>
                    <h2>Booking Confirmed!</h2>
                    <p>Your payment has been processed successfully</p>
                    
                    <div class="confirmation-details">
                        <div class="row">
                            <div class="col-sm-6">
                                <strong>Booking ID:</strong><br>
                                <span id="confirmation-booking-id">BK-123456</span>
                            </div>
                            <div class="col-sm-6">
                                <strong>Amount Paid:</strong><br>
                                <span id="confirmation-amount">$63.00</span>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-sm-6">
                                <strong>Payment Method:</strong><br>
                                <span id="confirmation-method">PayPal</span>
                            </div>
                            <div class="col-sm-6">
                                <strong>Date:</strong><br>
                                <span id="confirmation-date">Today</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button class="btn btn-success btn-lg me-2">
                        <i class="bi bi-download me-2"></i>Download Ticket
                    </button>
                    <button class="btn btn-outline-primary btn-lg">
                        <i class="bi bi-house me-2"></i>Go Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Enhanced Checkout Script -->
    <script src="static/js/checkout.js"></script>
    
    <!-- Test Functions -->
    <script>
        // Test functions for demonstrating enhanced features
        function testOfflineMode() {
            // Simulate offline mode
            Object.defineProperty(navigator, 'onLine', {
                writable: true,
                value: false
            });
            
            // Trigger offline event
            window.dispatchEvent(new Event('offline'));
            
            console.log('üîå Offline mode activated for testing');
        }
        
        function testOnlineMode() {
            // Simulate online mode
            Object.defineProperty(navigator, 'onLine', {
                writable: true,
                value: true
            });
            
            // Trigger online event
            window.dispatchEvent(new Event('online'));
            
            console.log('üåê Online mode activated');
        }
        
        function testError() {
            // Trigger an error for testing error handling
            if (window.checkout) {
                window.checkout.showError('This is a test error message to demonstrate error handling capabilities.', 
                                        () => console.log('Retry action triggered'));
            }
        }
        
        function testMobile() {
            // Simulate mobile viewport
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.content = 'width=375, initial-scale=1, user-scalable=no';
            }
            
            // Add mobile class
            document.body.classList.add('mobile-device');
            
            // Trigger resize
            window.dispatchEvent(new Event('resize'));
            
            console.log('üì± Mobile mode activated for testing');
        }
        
        function resetCheckout() {
            // Reset to step 1
            if (window.checkout) {
                window.checkout.goToStep(1);
                window.checkout.hideError();
                window.checkout.hideOfflineIndicator();
                window.checkout.hideLoadingOverlay();
            }
            
            // Reset viewport
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.content = 'width=device-width, initial-scale=1, user-scalable=no';
            }
            
            document.body.classList.remove('mobile-device');
            
            console.log('üîÑ Checkout reset to initial state');
        }
        
        // Mock API endpoints for testing
        function setupMockAPI() {
            // Mock fetch for payment methods
            const originalFetch = window.etch;
            window.fetch = function(url, options) {
                if (url.includes('/api/get-payment-methods')) {
                    return Promise.resolve({
                        ok: true,
                        json: () => Promise.resolve({
                            success: true,
                            methods: [
                                {
                                    id: 'paypal',
                                    name: 'PayPal',
                                    description: 'Pay with your PayPal account',
                                    gateway: 'paypal',
                                    icon: 'https://www.paypalobjects.com/webstatic/icon/pp258.png',
                                    conversion_required: false
                                },
                                {
                                    id: 'upi',
                                    name: 'UPI Payment',
                                    description: 'PhonePe, Google Pay, Paytm, etc.',
                                    gateway: 'razorpay',
                                    conversion_required: true
                                },
                                {
                                    id: 'card',
                                    name: 'Credit/Debit Card',
                                    description: 'Visa, Mastercard, RuPay',
                                    gateway: 'razorpay',
                                    conversion_required: true
                                },
                                {
                                    id: 'netbanking',
                                    name: 'Net Banking',
                                    description: 'All major Indian banks',
                                    gateway: 'razorpay',
                                    conversion_required: true
                                }
                            ]
                        })
                    });
                }
                
                if (url.includes('/api/create-payment-intent')) {
                    const requestData = JSON.parse(options.body);
                    
                    return Promise.resolve({
                        ok: true,
                        json: () => Promise.resolve({
                            success: true,
                            gateway: requestData.payment_method === 'paypal' ? 'paypal' : 'razorpay',
                            order_id: 'ORDER_' + Math.floor(Math.random() * 1000000),
                            approval_url: requestData.payment_method === 'paypal' ? 
                                'https://www.sandbox.paypal.com/checkoutnow?token=TEST' : null
                        })
                    });
                }
                
                // Fall back to original fetch for other requests
                return originalFetch ? originalFetch.apply(this, arguments) : 
                       Promise.reject(new Error('Fetch not available'));
            };
        }
        
        // Initialize mock API when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            setupMockAPI();
            
            // Add some demo console logs
            console.log('üèè CricVerse Enhanced Checkout Test Page Loaded');
            console.log('üì± Test mobile responsiveness with the Mobile Test button');
            console.log('üîå Test offline functionality with the Offline Test button');
            console.log('‚ö†Ô∏è Test error handling with the Error Test button');
            console.log('üí≥ Complete a test payment to see all enhancements in action');
        });
        
        // Demonstrate touch events on mobile
        let touchStartTime = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
        });
        
        document.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            if (touchDuration < 200) {
                console.log('üëÜ Touch interaction detected');
            }
        });
        
        // Keyboard navigation demonstration
        document.addEventListener('keydown', (e) => {
            if (e.altKey && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
                console.log('‚å®Ô∏è Keyboard navigation:', e.key);
            }
        });
    </script>
</body>
</html>